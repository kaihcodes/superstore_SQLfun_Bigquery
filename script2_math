With d as (
  SELECT Person,sum(a.Sales) as TotalSales
FROM `alien-cedar-469420-n9.superstore.sales` as a
left join 
(select *
from `alien-cedar-469420-n9.superstore.rep_name`
) b
on b.Region = a.Region
group by 1
)

select Person, sum(d.TotalSales) as Total, (
  select avg(d.TotalSales) from d
) as Average, case when sum(d.TotalSales) > (
  select avg(d.TotalSales) from d
) then 'Above par'
when sum(d.TotalSales)  = (
  select avg(d.TotalSales) from d
) then 'On par'
when sum(d.TotalSales) < (
  select avg(d.TotalSales) from d
) then 'Below par' end as Flag,
(select sum(d.TotalSales) from d) as GrandTotal,format('%s%%',cast(round(sum(d.TotalSales)/(select sum(d.TotalSales) from d) * 100, 2) as String)) as PercentofTotal
from d
group by 1
